# -------------------------- 基础配置（可按需微调） --------------------------
# 编译器（默认gcc）
CC := gcc
# 编译选项：-Wall显示所有警告，-g生成调试信息，-O2优化，-fPIC位置无关代码
CFLAGS := -Wall -g -O2 -fPIC
# 链接选项：必须链接pthread线程库（日志模块依赖）
LDFLAGS := -lpthread
# 目标可执行文件名称
TARGET := test_log

# -------------------------- 自动扫描（核心修改） --------------------------
# 自动扫描当前目录下所有.c文件（无需手动罗列SRCS）
SRCS := $(wildcard *.c)
# 自动推导对象文件（将所有.c替换为.o）
OBJS := $(SRCS:.c=.o)

# -------------------------- 核心编译规则 --------------------------
# 默认目标：编译生成可执行文件
all: $(TARGET)
	@echo "编译完成！可执行文件：./$(TARGET)"

# 生成可执行文件：依赖所有.o文件，链接线程库
$(TARGET): $(OBJS)
	@echo "链接生成可执行文件 $(TARGET)..."
	$(CC) $(CFLAGS) -o $(TARGET) $(OBJS) $(LDFLAGS)

# 编译所有.c文件为.o文件（自动匹配依赖，无需单独写每个.o的规则）
%.o: %.c
	@echo "编译 $< ..."
	$(CC) $(CFLAGS) -c $< -o $@

# -------------------------- 辅助功能规则 --------------------------
# 清理：删除可执行文件、所有.o目标文件
clean:
	@echo "清理生成文件..."
	rm -f $(TARGET) $(OBJS)
	# 可选：清理日志输出目录（/tmp/myapp_log/），如需保留可注释此行
	rm -rf /tmp/myapp_log/
	@echo "清理完成！"

# 伪目标：避免与同名文件冲突
.PHONY: all clean